// The introduction is vital to the exercise success. Why, you may wonder? Because we use it for marketing purposes. Think in the introduction as an announcement. Here is a checklist with the most important things to consider:

// üëâ Starting by making a statement that catches viewer‚Äôs attention. The statement must always point to a problem. Something like: ‚ÄúHave you ever felt the communication with your team is not as effective as it should be?‚Äù or ‚ÄúReporting to the project leads is an important everyday task, but ensuring that data comes from your BIM Model is even more crucial and not so easy in many cases.‚Äù Make sure your statement is as concise as possible.

// üëâ Once you got viewer‚Äôs attention, make it know that is perfectly possible to solve the problem by using the knowledge that is going to be acquired along the masterclass. Try to mention one or two key learnings of the lesson, but without too much detail to not reveal important content. Mention they will have the opportunity to learn it with a practical exercise. It‚Äôs important they know the learnings are going to be gathered by using a practical approach, while explaining important concepts along the way.

// üëâ As the viewer already know its problem can be solved really easy, you can mention the exercise to be done in the lesson. Try to explain it as brief as possible, always keeping in mind to talk about the use case of it. Needless to say, the use case must be linked with the problem being solved.

// üëâ After people know the exercise they are going to accomplish, mention the benefit of doing it. The benefit must be linked with the use case, and the use case its linked to the problem. You are basically talking about the benefit of solving the problem by studying the lesson.

// üëâ At this point, the viewer is probably eager to start right away. This is the perfect time to mention they not only have the video at its disposal, but also the guide where everything is explain step by step. This last part is a template, always use the following:

// I‚Äôm already hearing you eager to start learning, right? Well, the more resources the better! Let me tell you down below the lesson you have the guide with resources to learn more, the lesson key concepts, the step by step implementation of the exercise, the complete implementation code, and the quest you so can shine as a BIM Software Developer, everything just one click away. So, Get The Code and let‚Äôs build the open future together!

// üëâ The less, the better. It shouldn‚Äôt take too long, around 200 words is more than enough only if it fulfills the considerations above.

// TIP: Write your introduction in the same order as the considerations above, and also highlight them with the same colors so ensure everything is being addressed üòâ

// Examples:

// Navigating complex BIM models can often feel overwhelming‚Ä¶ specially when trying to understand what you are hovering over.
// That is why I developed a custom hoverer tool with Fragments 2.0 that can be of great help in these situations and I will show you how to implement it.
// The elements will visually respond to your mouse movements, instantly revealing what‚Äôs under the cursor.
// I know for certain that my team will be very grateful with this implementation to improve their workflow.

// BIM models are not perfect and sometimes elements intersect when they should not and we don‚Äôt even realize!
// That is why I decided to use the new Fragments 2.0 to create a Clash Detector that will help my team visualize the intersections between two models‚Äô categories and
// I will teach you how to implement it.
// This clash detector efficiently identifies the elements that interfere with each other so they can be corrected to improve design and the overall process.
// This will definitely help me and my team solve these kind of issues fast and easy.

// When visualizing BIM models we can easily see the final result of the project, but what if we wanted to check each individual stage of the construction?
// Well, of course we can easily do so with some new properties and That Open Engine, and I will teach you exactly how.
// A phase or stage is assigned to each element and with a simple slider I can filter out the ones corresponding to the phase that I want to see.
// So finally! Me and my team can see both the final result and each stage of the model with ease!

// Fragments 2.0 is already here and I know for sure you might be cracking your head around on how to use this new cool technology.
// I‚Äôve been working a lot with it and I will teach you how to use it to create a table that shows useful information from the elements.
// Fragments 2.0 makes it even easier to retrieve information from the BIM model and that information can be used to create a nice table while isolating elements of a category.
// So be prepared! You and your team will have it easier than ever to work with big BIM models!

// Picture this‚Ä¶ You are using an awesome component that is making your day to day work easier, and you think on how to make it even easier but don‚Äôt know how.
// Well.. I definitely got you. I‚Äôve been playing around with some components from That Open Engine and now I am able to create IDS requirements with just my voice!
// I can just speak into the mic to say the requirement I need and the component will automatically check all the elements in my BIM model to test the requirement.
// No more typing when my team wants to do a quick check, they just say it right off the top of their head.

// Being able to adapt to the different requirements that BIM projects present to us is what separates the best from the others. And as a BIM Software Developer
// I always look to expand my repertory of tools to integrate with That Open Engine such as Airtable to get information and easily update my BIM models.
// The information from an easily accessible database such as Airtable can be used to update simple properties and calculated quantities on the go by just selecting the element and the property
// I need to add. With this new integration, there won‚Äôt be any more limitations for new technologies that the BIM market needs.

// Having the information at the reach of your hand is critical when we are short on time and the reports are of the upmost importance.
// I knew a types schedule report was an implementation that could easily be done with That Open Engine and I will tell you exactly how.
// I can use three simple buttons to isolate, add the element type to the report and export the PDF file to get the data that I need at the moment, such as type counts.
// This will definitely be of help for my team when we need that crucial information on time.

// Turning our complex ideas into something can be a bit frustrating, specially when dealing with very important matters like specifications.
// But I am a simple man that knows how to make the most out of AI and That Open Engine to easily create IDS Specifications, and I will share that with you.
// I can simply write a concise and simple phrase of what I need for my requirement and have the AI convert that into an IDS file that can be used in my BIM project.
// No more cracking your head around, just be yourself and have the AI do the hard work for you!

// Have you ever had a fruitful conversation about your project‚Äôs issues and then didn‚Äôt know how to summarize it? Well‚Ä¶ I had.
// And most certainly I also had an amazing idea to integrate That Open Engine with Discord Bots to create a streaming data workflow that helps me with that.
// Every conversation that I have with my team can be transformed into a comment for a BCF Topic with a command that is easy to use and remember.
// With this useful idea, I have made my life and my team‚Äôs work a lot more easier by streamlining something as simple as a conversation.

// Being able to load revit files into our BIM App is an awesome feature, but what happens after that? I bet you wonder the same and by the way
// I found out how to load Autodesk‚Äôs Issues right into my BIM App to have an extended implementation with That Open Engine. I can have my revit files available and also all the issues
// related to it within one single instance of my App, everything loaded from the Construction Cloud, nice and easy. So now my team‚Äôs workflow expands even more adapting to new
// requirements and necessities.

// Lots of projects are already stored in the Autodesk Construction Cloud‚Ä¶ and that is perfectly fine,
// but currently there is no way to load Revit files from the ACC directly to your custom BIM App.
// That‚Äôs what I thought until I put That Open Engine to the test and developed a component that does exactly that.
// The ability to load the Revit files from the cloud to my BIM App turns it into a versatile tool that takes my team‚Äôs workflow to a whole new level.
// This development will result in less manual file processing effectively expanding new horizons for us to work in.

// When dealing with big projects and BIM models, sometimes extracting specific information can be intricate and time consuming.
// But as technology evolves and so does That Open Engine, I found a way to get the inventory from the rooms in my BIM model in the most creative way possible.
// This component that dynamically hides and shows elements based on its room location to find the needed information is the perfect tool that my team needed to save time.
// From now on, my team will have it easy to get the inventory from the BIM models.

// Managing and categorizing elements with existing BIM classifications can be difficult, and most of the time we don't have the necessary tools to do so.
// I care about my team and I realized that with my BIM Software Developer skills and That Open Engine it was possible to create a useful classifications manager.
// The implementation of a system to create, insert and manage custom classifications is way simpler than I thought and it took me less than I could ever imagine to develop it.
// Now my team can easily incorporate and manage diverse classification systems within our models.

// We humans are very forgetful, sometimes we don‚Äôt remember what we had for breakfast. But there are things that are crucial to remember,
// like doing maintenance to the construction yet we have nothing to remind us. As a BIM Software Developer, I already solved this problem for my team and I will teach you
// exactly how to automate maintenance remainders with That Open Engine. I have implemented a solution to add properties to my BIM model for maintenance dates and a schedule to have
// emails be sent to my team alerting of upcoming maintenances. With this implementation, not a single maintenance will be missed again in the future.

// Extracting accurate plan views from BIM models can be a real headache‚Äîespecially when you need a clean DXF drawing at a specific height for coordination or documentation.
// That‚Äôs why I built a tool that lets you use a plane anywhere in your 3D model and instantly generate a DXF file of the intersection.
// This plane can be easily moved vertically so you can find the perfect spot to get the drawing you need.
// I know this workflow will save you and your team hours of manual work and ensure your drawings always match your latest design.

// We previously created our own DXF files‚Ä¶ but what if instead we wanted to import them and adjust the data to our model?
// I recently ran into this problem and I knew for sure that I could use That Open Engine to create a tool that would allow me to easily import those files.
// This tool allows me to scale, flip and relocate and imported DXF file to place it in my model with very high precision.
// I am certain that this will allow my team to work with DXF file without any trouble.

import * as OBC from "@thatopen/components";
import * as FRAGS from "@thatopen/fragments";
import { MiroApi } from "@mirohq/miro-api";
import { DataSet } from "@thatopen/components";

export class MiroConnector extends OBC.Component {
  enabled = false;
  static readonly uuid = "052229cb-31c2-4c69-831f-a7da5a1cd153";

  miroApi: MiroApi = new MiroApi(import.meta.env.VITE_MIRO_TOKEN);
  categories = new DataSet<string>();

  constructor(components: OBC.Components) {
    super(components);
    components.add(MiroConnector.uuid, this);
  }

  private _fragments: FRAGS.FragmentsModels | null = null;
  set fragments(value: FRAGS.FragmentsModels | null) {
    this._fragments = value;
  }

  get fragments() {
    return this._fragments;
  }

  async init() {
    await this.getCategories();
  }

  private async getCategories() {
    if (!(this.fragments && this.categories))
      throw new Error("MiroConnector: No Fragments Set!");

    for (const [_, model] of this.fragments.models.list) {
      const itemsWithGeometry = await model.getItemsWithGeometry();

      for (const item of itemsWithGeometry) {
        const category = await item.getCategory();
        if (!category) continue;
        if (this.categories.has(category)) continue;
        this.categories.add(category);
      }
    }
  }

  async createStickyNote(boardId: string, category: string) {
    if (!this.fragments) throw new Error("MiroConnector: No Fragments set!");

    const board = await this.miroApi.getBoard(boardId);

    for (const [_, model] of this.fragments.models.list) {
      const elementsOfCategory = await model.getItemsOfCategory(category);
      const elementsCount = elementsOfCategory.length;

      console.log(board);

      await board.createStickyNoteItem({
        data: {
          content: `There are ${elementsCount} elements that belong to the ${category} category.`,
          shape: "square",
        },
        style: {
          fillColor: "light_yellow",
          textAlign: "center",
          textAlignVertical: "top",
        },
        position: {
          x: 0,
          y: 0,
        },
      });
    }
  }

  async getData(boardId: string) {
    const board = await this.miroApi.getBoard(boardId);
    const result = board.getAllItems("items?type=sticky_note");

    for await (const item of result) {
      console.log(item);
    }
  }
}

export * from "./src";
